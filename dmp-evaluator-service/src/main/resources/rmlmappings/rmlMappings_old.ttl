@prefix rr: <http://www.w3.org/ns/r2rml#> .
@prefix rml: <http://semweb.mmlab.be/ns/rml#> .
@prefix ql: <http://semweb.mmlab.be/ns/ql#> .
@prefix dcat: <http://www.w3.org/ns/dcat#> .
@prefix dmp: <http://purl.org/dmp#> .
@prefix foaf: <http://xmlns.com/foaf/0.1/> .
@prefix xsd: <http://www.w3.org/2001/XMLSchema#> .
@prefix dcso: <https://w3id.org/dcso/ns/core#> .
@prefix terms: <http://purl.org/dc/terms/> .
@prefix fno: <https://w3id.org/function/ontology#> .
@prefix fnml: <http://semweb.mmlab.be/ns/fnml#> .
@prefix exf: <http://example.org/functions#> .

@base <https://w3id.org/dcso/ns/core>.

# Functions
exf:sha1 a fno:Function ;
    fno:name "sha1" ;
    fno:expects [
        a fno:Parameter ;
        fno:predicate exf:value ;
        fno:type xsd:string
    ] ;
    fno:returns [
        a fno:Output ;
        fno:predicate exf:hashed ;
        fno:type xsd:string
    ] .


# DMP
<#DMPMapping> a rml:LogicalSource ;
    rml:source "{{madmp_json_path}}" ;
    rml:referenceFormulation ql:JSONPath ;
    rml:iterator "$.dmp" .

<#DMPTriplesMap> a rr:TriplesMap ;
    rml:logicalSource <#DMPMapping> ;
    rr:subjectMap [
        rml:reference "dmp_id.identifier" ;
        rr:termType rr:IRI ;
        rr:class dmp:DataManagementPlan
    ] ;
    rr:predicateObjectMap [
        rr:predicate terms:title ;
        rr:objectMap [ rml:reference "$.title" ]
    ] ;
    rr:predicateObjectMap [
        rr:predicate terms:description ;
        rr:objectMap [ rml:reference "$.description" ]
    ] ;
    rr:predicateObjectMap [
        rr:predicate dcso:language ;
        rr:objectMap [ rml:reference "$.language" ]
    ] ;
    rr:predicateObjectMap [
        rr:predicate dcso:created ;
        rr:objectMap [ rml:reference "$.created" ; rr:datatype xsd:dateTime ]
    ] ;
    rr:predicateObjectMap [
        rr:predicate dcso:modified ;
        rr:objectMap [ rml:reference "$.modified" ; rr:datatype xsd:dateTime ]
    ] ;
    rr:predicateObjectMap [
        rr:predicate dcso:identifierType ;
        rr:objectMap [ rml:reference "$.dmp_id.type" ]
    ] ;
    rr:predicateObjectMap [
        rr:predicate dcso:ethicalIssuesExist ;
        rr:objectMap [ rml:reference "$.ethical_issues_exist" ]
    ] ;
    rr:predicateObjectMap [
        rr:predicate dmp:ethicalIssuesReport ;
        rr:objectMap [ rml:reference "$.ethical_issues_report" ]
    ] ;
    rr:predicateObjectMap [
        rr:predicate dmp:ethicalIssuesDescription ;
        rr:objectMap [ rml:reference "$.ethical_issues_description" ]
    ] ;
    rr:predicateObjectMap [
        rr:predicate dmp:contact ;
        rr:objectMap [ rml:reference "$.contact.contact_id.identifier" ;
                       rr:termType rr:IRI ]
    ] ;
    rr:predicateObjectMap [
        rr:predicate dmp:contact ;
        rr:objectMap [ rml:reference "$.contributor.contributor_id.identifier" ;
                       rr:termType rr:IRI ]
    ] ;
    rr:predicateObjectMap [
        rr:predicate dmp:contact ;
        rr:objectMap [ rml:reference "$.project.project_id" ;
                       rr:termType rr:IRI ]
    ] ;
    rr:predicateObjectMap [
        rr:predicate dcso:hasContact ;
        rr:objectMap [
            rr:termType rr:IRI ;
            fnml:functionValue [
                rr:predicateObjectMap [
                    rr:predicate fno:executes ;
                    rr:objectMap [ rr:constant exf:sha1 ]
                ] ;
                rr:predicateObjectMap [
                    rr:predicate exf:value ;
                    rr:objectMap [ rml:reference "$.contact.contact_id.identifier" ]
                ]
            ] ;
            rr:template "https://w3id.org/dcso/ns/core/{.}"
        ] .
    ] .

# Contact
<#ContactMapping> a rml:LogicalSource ;
    rml:source "{{madmp_json_path}}";
    rml:referenceFormulation ql:JSONPath ;
    rml:iterator "$.dmp.contact" .

<#ContactTriplesMap> a rr:TriplesMap ;  
    rml:logicalSource <#ContactMapping> ;
    rr:subjectMap [
        rr:termType rr:IRI ;
            fnml:functionValue [
                rr:predicateObjectMap [
                    rr:predicate fno:executes ;
                    rr:objectMap [ rr:constant exf:sha1 ]
                ] ;
                rr:predicateObjectMap [
                    rr:predicate exf:value ;
                    rr:objectMap [ rml:reference "$.contact_id.identifier" ]
                ]
            ] ;
            rr:template "https://w3id.org/dcso/ns/core/{.}"
    ] ;
    rr:predicateObjectMap [
        rr:predicate foaf:name ;
        rr:objectMap [ rml:reference "$.name" ]
    ] ;
    rr:predicateObjectMap [
        rr:predicate foaf:mbox ;
        rr:objectMap [ rml:reference "$.mbox" ]
    ] ;
    rr:predicateObjectMap [
        rr:predicate dcso:hasContactId ;
        rr:objectMap [ rml:reference "$.contact_id.identifier" ]
    ] .
    #rr:predicateObjectMap [
    #    rr:predicate dmp:contact_type ;
    #    rr:objectMap [ rml:reference "$.contact_id.type" ]
    #] .

# Contributor
<#ContributorMapping> a rml:LogicalSource ;
    rml:source "{{madmp_json_path}}";
    rml:referenceFormulation ql:JSONPath ;
    rml:iterator "$.dmp.contributor[*]" .

<#ContributorTriplesMap> a rr:TriplesMap ;
    rml:logicalSource <#ContributorMapping> ;
    rr:subjectMap [
        rml:reference "contributor_id.identifier" ;
        rr:termType rr:IRI ;
        rr:class foaf:Person
    ] ;
    rr:predicateObjectMap [
        rr:predicate foaf:name ;
        rr:objectMap [ rml:reference "$.name" ]
    ] ;
    rr:predicateObjectMap [
        rr:predicate foaf:mbox ;
        rr:objectMap [ rml:reference "$.mbox" ]
    ] ;
    rr:predicateObjectMap [
        rr:predicate dmp:identifier_type ;
        rr:objectMap [ rml:reference "$.contributor_id.type" ]
    ] .
    rr:predicateObjectMap [
        rr:predicate dmp:role ;
        rr:objectMap [ rml:reference "$.role" ]
    ] .

# Project
<#ProjectMapping> a rml:LogicalSource ;
    rml:source "{{madmp_json_path}}";
    rml:referenceFormulation ql:JSONPath ;
    rml:iterator "$.dmp.project[*]" .

<#ProjectTriplesMap> a rr:TriplesMap ;
    rml:logicalSource <#ProjectMapping> ;
    rr:subjectMap [
        rml:reference "project_id" ;
        rr:termType rr:IRI ;
        rr:class dmp:Project
    ] ;
    rr:predicateObjectMap [
        rr:predicate dmp:project_id_type ;
        rr:objectMap [ rml:reference "$.project_id_type" ]
    ] ;
    rr:predicateObjectMap [
        rr:predicate dmp:title ;
        rr:objectMap [ rml:reference "$.title" ]
    ] ;
    rr:predicateObjectMap [
        rr:predicate dmp:description ;
        rr:objectMap [ rml:reference "$.description" ]
    ] ;
    rr:predicateObjectMap [
        rr:predicate dmp:start ;
        rr:objectMap [ rml:reference "$.start" ; rr:datatype xsd:dateTime ]
    ] ;
    rr:predicateObjectMap [
        rr:predicate dmp:end ;
        rr:objectMap [ rml:reference "$.end" ; rr:datatype xsd:dateTime ]
    ] ;
    rr:predicateObjectMap [
        rr:predicate dcso:hasFunding ;
        rr:objectMap [ rml:template "https://w3id.org/dcso/ns/core#{funder_id.identifier}/{grant_id.identifier}" ]
    ] .

# Project - Funding
<#FundingMapping> a rml:LogicalSource ;
    rml:source "{{madmp_json_path}}";
    rml:referenceFormulation ql:JSONPath ;
    rml:iterator "$.dmp.project[*].funding[*]" .

<#FundingTriplesMap> a rr:TriplesMap ;  
    rml:logicalSource <#FundingMapping> ;
    rr:subjectMap [
        rml:template "https://w3id.org/dcso/ns/core#{funder_id.identifier}/{grant_id.identifier}" ;
        rr:termType rr:IRI ;
        rr:class dcso:Funding
    ] ;
    rr:predicateObjectMap [
        rr:predicate dcso:hasFunderId ;
        rr:objectMap [ rml:reference "$.funder_id.identifier" ]
    ] ;
    rr:predicateObjectMap [
        rr:predicate dcso:funder_id_type ;
        rr:objectMap [ rml:reference "$.funder_id.type" ]
    ] ;
    rr:predicateObjectMap [
        rr:predicate dcso:funder_name ;
        rr:objectMap [ rml:reference "$.funder_name" ]
    ] ;
    rr:predicateObjectMap [
        rr:predicate dcso:hasGrantId ;
        rr:objectMap [ rml:reference "$.grant_id.identifier" ]
    ] ;
    rr:predicateObjectMap [
        rr:predicate dcso:grant_type ;
        rr:objectMap [ rml:reference "$.grant_id.type" ]
    ] .



# Dataset
<#DatasetMapping> a rml:LogicalSource ;
    rml:source "{{madmp_json_path}}";
    rml:referenceFormulation ql:JSONPath ;
    rml:iterator "$.dmp.dataset[*]" .

<#DatasetTriplesMap> a rr:TriplesMap ;
    rml:logicalSource <#DatasetMapping> ;
    rr:subjectMap [
        rml:reference "dataset_id.identifier" ;
        rr:termType rr:IRI ;
        rr:class dcat:Dataset
    ] ;
    rr:predicateObjectMap [
        rr:predicate dmp:dataset_id_type ;
        rr:objectMap [ rml:reference "$.dataset_id.type" ]
    ] ;
    rr:predicateObjectMap [
        rr:predicate dcat:title ;
        rr:objectMap [ rml:reference "$.title" ]
    ] ;
    rr:predicateObjectMap [
        rr:predicate dmp:personal_data ;
        rr:objectMap [ rml:reference "$.personal_data" ]
    ] ;
    rr:predicateObjectMap [
        rr:predicate dcat:sensitive_data ;
        rr:objectMap [ rml:reference "$.sensitive_data" ]
    ] ;
    rr:predicateObjectMap [
        rr:predicate dmp:type ;
        rr:objectMap [ rml:reference "$.type" ]
    ] ;
    rr:predicateObjectMap [
        rr:predicate dcat:description ;
        rr:objectMap [ rml:reference "$.description" ]
    ] .
    # distribution mapping

# Dataset - Distribution